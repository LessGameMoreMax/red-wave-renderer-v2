#ifndef TC_SIZE_CLASSES_H
#define TC_SIZE_CLASSES_H
#include "TCCommon.h"
#include "TCSizeClassInfo.h"
#include "Platform.h"
#include "../Misc/MacroDefine.h"
#include INCLUDE_PLATFORM_HEADER(.., Platform.h)
namespace sablin{

#if (!defined(USE_PLATFORM_ALIGNMENT) && __STDCPP_DEFAULT_NEW_ALIGNMENT__ <= 8u) || MEMORY_ALIGNMENT_DEFAULT == 8u
#define TC_ALIGNMENT_SHIFT 3
#if TC_MALLOC_PAGE_SHIFT == 15
    inline constexpr std::size_t kBucketNum = 73;
    static constexpr TCSizeClassInfo kSizeClassInfoArray[kBucketNum] = {
        {        8},
        {       16},
        {       32},
        {       64},
        {       72},
        {       80},
        {       88},
        {       96},
        {      104},
        {      112},
        {      120},
        {      128},
        {      144},
        {      160},
        {      176},
        {      192},
        {      208},
        {      232},
        {      256},
        {      272},
        {      296},
        {      320},
        {      352},
        {      400},
        {      448},
        {      480},
        {      512},
        {      576},
        {      640},
        {      704},
        {      832},
        {      896},
        {     1024},
        {     1152},
        {     1280},
        {     1408},
        {     1536},
        {     1920},
        {     2048},
        {     2176},
        {     2432},
        {     2688},
        {     3200},
        {     3584},
        {     4096},
        {     4608},
        {     5376},
        {     6528},
        {     7168},
        {     8192},
        {     9344},
        {    10880},
        {    13056},
        {    13952},
        {    16384},
        {    19072},
        {    21760},
        {    24576},
        {    28672},
        {    32768},
        {    38144},
        {    40960},
        {    49152},
        {    57344},
        {    65536},
        {    81920},
        {    98304},
        {   114688},
        {   131072},
        {   163840},
        {   196608},
        {   229376},
        {   262144},
    };
#elif TC_MALLOC_PAGE_SHIFT == 18
    inline constexpr std::size_t kBucketNum = 84;
    static constexpr TCSizeClassInfo kSizeClassInfoArray[kBucketNum] = {
        {        8},
        {       16},
        {       32},
        {       64},
        {       72},
        {       80},
        {       88},
        {       96},
        {      104},
        {      112},
        {      128},
        {      144},
        {      160},
        {      176},
        {      192},
        {      208},
        {      232},
        {      256},
        {      272},
        {      304},
        {      352},
        {      400},
        {      472},
        {      512},
        {      576},
        {      640},
        {      704},
        {      768},
        {      896},
        {     1024},
        {     1152},
        {     1280},
        {     1408},
        {     1536},
        {     1664},
        {     1920},
        {     2048},
        {     2304},
        {     2560},
        {     2816},
        {     3072},
        {     3328},
        {     3584},
        {     3840},
        {     4096},
        {     4352},
        {     4736},
        {     5632},
        {     6528},
        {     7168},
        {     8192},
        {     8704},
        {     9344},
        {     9984},
        {    10880},
        {    11904},
        {    13056},
        {    13696},
        {    14464},
        {    15360},
        {    16384},
        {    17408},
        {    18688},
        {    20096},
        {    21760},
        {    23808},
        {    26112},
        {    29056},
        {    32768},
        {    37376},
        {    43648},
        {    52352},
        {    56064},
        {    65536},
        {    74880},
        {    87296},
        {   104832},
        {   112256},
        {   131072},
        {   149760},
        {   174720},
        {   196608},
        {   209664}, 
        {   262144}, 
    };
#else
    #error "Wrong TCSizeClasses TCMAllocPageShift!"
#endif
#else
#define TC_ALIGNMENT_SHIFT 4
#if TC_MALLOC_PAGE_SHIFT == 15
    inline constexpr std::size_t kBucketNum = 77;
    static constexpr TCSizeClassInfo kSizeClassInfoArray[kBucketNum] = {
        {        8},
        {       16},
        {       32},
        {       48}, // Add New Size
        {       64},
        // {       72}, // Delete Size
        {       80},
        // {       88}, // Delete Size
        {       96},
        // {      104}, // Delete Size
        {      112},
        // {      120}, // Delete Size
        {      128},
        {      144},
        {      160},
        {      176},
        {      192},
        {      208},
        {      224}, // Add New Size
        // {      232}, // Delete Size
        {      240}, // Add New Size
        {      256},
        // {      272},
        {      288}, // Add New Size
        // {      296}, // Delete Size
        {      304}, // Add New Size
        {      320},
        {      336}, // Add New Size
        {      352},
        {      368}, // Add New Size
        {      384}, // Add New Size
        {      400},
        {      432}, // Add New Size
        {      448},
        {      480},
        {      512},
        {      576},
        {      640},
        {      704},
        {      832},
        {      896},
        {     1024},
        {     1152},
        {     1280},
        {     1408},
        {     1536},
        {     1920},
        {     2048},
        {     2176},
        {     2432},
        {     2688},
        {     3200},
        {     3584},
        {     4096},
        {     4608},
        {     5376},
        {     6528},
        {     7168},
        {     8192},
        {     9344},
        {    10880},
        {    13056},
        {    13952},
        {    15104}, //Add New Size
        {    16384},
        {    19072},
        {    21760},
        {    24576},
        {    26240}, //Add New Size
        {    28672},
        {    32768},
        {    38144},
        {    40960},
        {    49152},
        {    57344},
        {    65536},
        {    81920},
        {    98304},
        {   114688},
        {   131072},
        {   163840},
        {   196608},
        {   229376},
        {   262144},
    };
#elif TC_MALLOC_PAGE_SHIFT == 18
    inline constexpr std::size_t kBucketNum = 88;
    static constexpr TCSizeClassInfo kSizeClassInfoArray[kBucketNum] = {
        {        8},
        {       16},
        {       32},
        {       48}, // Add New Size
        {       64},
        // {       72}, // Delete Size
        {       80},
        // {       88}, // Delete Size
        {       96},
        // {      104}, // Delete Size
        {      112},
        {      128},
        {      144},
        {      160},
        {      176},
        {      192},
        {      208},
        // {      232}, // Delete Size
        {      224}, // Add New Size
        {      240}, // Add New Size
        {      256},
        {      272},
        {      288}, // Add New Size
        {      304},
        {      336}, // Add New Size
        {      352},
        {      400},
        {      432}, // Add New Size
        {      472},
        {      512},
        {      576},
        {      640},
        {      704},
        {      768},
        {      896},
        {     1024},
        {     1152},
        {     1280},
        {     1408},
        {     1536},
        {     1664},
        {     1920},
        {     2048},
        {     2304},
        {     2560},
        {     2816},
        {     3072},
        {     3328},
        {     3584},
        {     3840},
        {     4096},
        {     4352},
        {     4736},
        {     5632},
        {     6528},
        {     7168},
        {     8192},
        {     8704},
        {     9344},
        {     9984},
        {    10880},
        {    11904},
        {    12288}, // Add New Size
        {    13056},
        {    13696},
        {    14464},
        {    15360},
        {    16384},
        {    17408},
        {    18688},
        {    20096},
        {    21760},
        {    23808},
        {    24567}, // Add New Size
        {    26112},
        {    29056},
        {    32768},
        {    37376},
        {    43648},
        {    52352},
        {    56064},
        {    65536},
        {    74880},
        {    87296},
        {   104832},
        {   112256},
        {   131072},
        {   149760},
        {   174720},
        {   196608},
        {   209664},
        {   262144},
    };
#else
    #error "Wrong TCSizeClasses TCMAllocPageShift!"
#endif
#endif

}
#endif
